# ğŸ“± TASKTRACK PRO - ARQUITECTURA VISUAL

## ğŸ—ï¸ CAPAS DE LA APLICACIÃ“N

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ“± CAPA DE PRESENTACIÃ“N                    â”‚
â”‚          Pages (Login, Tasks, TaskDetail) + Components       â”‚
â”‚                   [Ionic + Angular 20]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ›¡ï¸ CAPA DE SEGURIDAD & ROUTING                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ AuthGuard        â”‚ AuthInterceptor    â”‚ HttpClient    â”‚  â”‚
â”‚  â”‚ CanActivate      â”‚ Bearer Token       â”‚ with Retry   â”‚  â”‚
â”‚  â”‚ Protege /tasks   â”‚ Attach JWT        â”‚ & Backoff     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  âš™ï¸ CAPA DE SERVICIOS                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    AuthService                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ Firebase Authentication (primary)              â”‚  â”‚
â”‚  â”‚  â”œâ”€ PBKDF2 Auth (fallback local)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ Session management                            â”‚  â”‚
â”‚  â”‚  â””â”€ Encryption key derivation                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               EncryptionService                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ AES-256-GCM encryption                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Key management from token                      â”‚  â”‚
â”‚  â”‚  â””â”€ Transparent encrypt/decrypt                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 ApiService                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ CRUD operations (GET/POST/PUT/DELETE)         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Offline sync queue                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Retry with exponential backoff                â”‚  â”‚
â”‚  â”‚  â””â”€ Conflict resolution by updatedAt              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            PerifÃ©ricos Services                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ CameraService        (capture/select/delete)   â”‚  â”‚
â”‚  â”‚  â”œâ”€ GpsService           (getCurrentLocation/watch)â”‚  â”‚
â”‚  â”‚  â””â”€ PermissionsService   (unified + alerts)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ğŸ“¦ CAPA DE MODELOS & TIPOS                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   User Model  â”‚  â”‚   Task Model     â”‚  â”‚ API Models â”‚  â”‚
â”‚  â”œâ”€ id           â”‚  â”œâ”€ id              â”‚  â”œâ”€ Response  â”‚  â”‚
â”‚  â”œâ”€ email        â”‚  â”œâ”€ userId          â”‚  â”œâ”€ GpsLoc    â”‚  â”‚
â”‚  â”œâ”€ createdAt    â”‚  â”œâ”€ title           â”‚  â””â”€ SyncQueue â”‚  â”‚
â”‚  â””â”€ lastLogin    â”‚  â”œâ”€ description     â”‚               â”‚  â”‚
â”‚                  â”‚  â”œâ”€ photoUrl        â”‚               â”‚  â”‚
â”‚                  â”‚  â”œâ”€ latitude        â”‚               â”‚  â”‚
â”‚                  â”‚  â”œâ”€ longitude       â”‚               â”‚  â”‚
â”‚                  â”‚  â”œâ”€ done            â”‚               â”‚  â”‚
â”‚                  â”‚  â”œâ”€ syncStatus      â”‚               â”‚  â”‚
â”‚                  â”‚  â””â”€ deleted         â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  âŒ Prohibido: any | unknown sin contexto                 â”‚
â”‚  âœ… Requerido: Full type coverage                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” FLUJO DE SEGURIDAD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario Input   â”‚
â”‚  (email/pwd)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    AuthService.login()                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Conectar a Firebase                   â”‚
â”‚    â””â”€â†’ signInWithEmailAndPassword()      â”‚
â”‚        â””â”€â†’ Obtener ID Token              â”‚
â”‚                                          â”‚
â”‚ 2. Si Firebase falla, usar PBKDF2 local â”‚
â”‚    â””â”€â†’ pbkdf2Hash(password, salt, 100k) â”‚
â”‚        â””â”€â†’ Comparar hash almacenado     â”‚
â”‚                                          â”‚
â”‚ 3. Persistir sesiÃ³n                      â”‚
â”‚    â””â”€â†’ Preferences.set(session)          â”‚
â”‚        [ENCRIPTADO nativamente]          â”‚
â”‚                                          â”‚
â”‚ 4. Derivar clave de cifrado              â”‚
â”‚    â””â”€â†’ PBKDF2(token, salt, 100k)        â”‚
â”‚        â””â”€â†’ AES-256 key (32 bytes)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    âœ… Autenticado
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ApiService Request                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GET /tasks                               â”‚
â”‚ Headers: Authorization: Bearer {token}   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Respuesta del Server                   â”‚
â”‚   [200] Tasks: [{...}, {...}]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EncryptionService                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Para cada task:                          â”‚
â”‚ 1. AES-256-GCM encrypt()                 â”‚
â”‚    â”œâ”€ IV: 12 random bytes                â”‚
â”‚    â”œâ”€ Ciphertext: encrypted data         â”‚
â”‚    â””â”€ AuthTag: 16 bytes (verificaciÃ³n)   â”‚
â”‚                                          â”‚
â”‚ 2. Almacenar en Preferences              â”‚
â”‚    â””â”€ JSON.stringify({iv, ct, tag})     â”‚
â”‚        [ENCRIPTADO nativamente]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    âœ… Datos seguros en local storage
```

---

## ğŸ”„ FLUJO DE SINCRONIZACIÃ“N OFFLINE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Usuario: Crear nueva tarea         â”‚
â”‚  (sin conexiÃ³n a internet)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApiService.createTask(task)        â”‚
â”‚  - Red NO disponible                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Encolar en SyncQueue               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ enqueueSync('CREATE', taskId, {...})â”‚
â”‚ â”œâ”€ Generar: SyncQueueItem           â”‚
â”‚ â”œâ”€ Persistir en Preferences         â”‚
â”‚ â””â”€ Retornar optimista al usuario    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      ğŸ”„ Cola en local storage:
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ {                  â”‚
      â”‚  operation: 'C'    â”‚
      â”‚  taskId: '123'     â”‚
      â”‚  payload: {...}    â”‚
      â”‚  retryCount: 0     â”‚
      â”‚  timestamp: now    â”‚
      â”‚ }                  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    ğŸ“µ Usuario sigue trabajando (offline)
    âœ… App sigue funcionando
             â”‚
             â†“
    ğŸŸ¢ Red restaurada
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApiService.processSyncQueue()      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Para cada item en queue:            â”‚
â”‚ 1. Ejecutar operaciÃ³n (POST /tasks) â”‚
â”‚    â”œâ”€ Retry: 3 intentos             â”‚
â”‚    â””â”€ Backoff: 1s, 2s, 4s          â”‚
â”‚                                     â”‚
â”‚ 2. Si Ã©xito:                        â”‚
â”‚    â””â”€ Remover de queue              â”‚
â”‚       Actualizar timestamp          â”‚
â”‚                                     â”‚
â”‚ 3. Si falla 3 veces:                â”‚
â”‚    â””â”€ Marcar como error             â”‚
â”‚       Mostrar al usuario            â”‚
â”‚       OpciÃ³n: Reintentar            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
    âœ… Todo sincronizado
       Queue vacÃ­a
```

---

## ğŸª ALMACENAMIENTO DE DATOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOCAL STORAGE (@capacitor/preferences)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  Key: auth_session                                    â”‚
â”‚  Value: {                                             â”‚
â”‚    userId: '...',                                     â”‚
â”‚    email: '...',                                      â”‚
â”‚    loginAt: 1704067200000,                           â”‚
â”‚    firebaseToken: 'eyJhbGc...'  â† ID Token          â”‚
â”‚  }                                                    â”‚
â”‚  [ENCRIPTADO por el SO - iOS/Android]                â”‚
â”‚                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                        â”‚
â”‚  Key: encryption_key                                  â”‚
â”‚  Value: {                                             â”‚
â”‚    key: 'a1b2c3d4e5f6...'  â† AES-256 derivada      â”‚
â”‚    salt: 'xyz789...'        â† Del token             â”‚
â”‚  }                                                    â”‚
â”‚  [ENCRIPTADO por el SO]                              â”‚
â”‚                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                        â”‚
â”‚  Key: tasks_local                                     â”‚
â”‚  Value: [                                             â”‚
â”‚    {                                                  â”‚
â”‚      id: '1',                                         â”‚
â”‚      title: 'AES256-GCM{...}',  â† Encriptado        â”‚
â”‚      description: 'AES256-GCM{...}',                â”‚
â”‚      done: false,                                     â”‚
â”‚      syncStatus: 'PENDING' | 'SYNCED' | 'ERROR'    â”‚
â”‚    },                                                 â”‚
â”‚    ...                                                â”‚
â”‚  ]                                                    â”‚
â”‚  [ENCRIPTADO por el SO]                              â”‚
â”‚                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                        â”‚
â”‚  Key: sync_queue                                      â”‚
â”‚  Value: [                                             â”‚
â”‚    {                                                  â”‚
â”‚      operation: 'CREATE|UPDATE|DELETE',             â”‚
â”‚      taskId: '1',                                     â”‚
â”‚      payload: {...},                                 â”‚
â”‚      retryCount: 0,                                  â”‚
â”‚      timestamp: 1704067234567                       â”‚
â”‚    },                                                 â”‚
â”‚    ...                                                â”‚
â”‚  ]                                                    â”‚
â”‚  [ENCRIPTADO por el SO]                              â”‚
â”‚                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                        â”‚
â”‚  Key: user_credentials_hash  [Fallback local]       â”‚
â”‚  Value: {                                             â”‚
â”‚    salt: 'crypto.randomBytes(32)',                  â”‚
â”‚    hash: 'sha256(pbkdf2(...))',                    â”‚
â”‚    iterations: 100000                                â”‚
â”‚  }                                                    â”‚
â”‚  [ENCRIPTADO por el OS]                              â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”’ SEGURIDAD DE ALMACENAMIENTO:
   â”œâ”€ iOS: Keychain (AES-256 automÃ¡tico)
   â”œâ”€ Android: EncryptedSharedPreferences
   â””â”€ Fallback: AES-256-GCM manual
```

---

## ğŸ“¡ CICLO DE VIDA DE UNA PETICIÃ“N AUTENTICADA

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pages/components/pages/tasks.page.ts   â”‚
â”‚  constructor(apiService: ApiService) {} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ ngOnInit() â†’ apiService.getTasks()
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApiService.getTasks()                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ this.http.get<ApiResponse>('/tasks')
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthInterceptor.intercept()            â”‚
â”‚  âœ… Intercepta request                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Obtener token:                      â”‚
â”‚     const token = await              â”‚
â”‚       authService.getIdToken()        â”‚
â”‚                                       â”‚
â”‚  2. Clonar request con Bearer:        â”‚
â”‚     request = request.clone({         â”‚
â”‚       setHeaders: {                   â”‚
â”‚         Authorization: 'Bearer ...'   â”‚
â”‚       }                               â”‚
â”‚     });                               â”‚
â”‚                                       â”‚
â”‚  3. Continuar cadena:                 â”‚
â”‚     return next.handle(request);      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend API                            â”‚
â”‚  POST /tasks                            â”‚
â”‚  Headers: Authorization: Bearer {token} â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ âœ… 200 OK â†’ Retornar tasks
         â”œâ”€ âŒ 401 Unauthorized â†’ Logout
         â”œâ”€ âŒ 403 Forbidden â†’ Logout
         â””â”€ âŒ 500+ â†’ Retry con backoff
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthInterceptor.intercept() - Error    â”‚
â”‚  âœ… Captura response                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  if (status === 401 || status === 403) â”‚
â”‚    â”œâ”€ authService.logout()             â”‚
â”‚    â”œâ”€ router.navigate(['/login'])      â”‚
â”‚    â””â”€ throw new Error()                â”‚
â”‚                                        â”‚
â”‚  else if (status >= 500)               â”‚
â”‚    â””â”€ retry(3) con exponential backoff â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApiService - Response Handling         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Verificar {success: boolean}        â”‚
â”‚  2. Extraer data si success === true    â”‚
â”‚  3. Encriptar cada task antes almacenar â”‚
â”‚     EncryptionService.encryptObject()   â”‚
â”‚  4. Persistir en Preferences (local DB) â”‚
â”‚  5. Retornar como Observable<Task[]>   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pages/components/pages/tasks.page.ts   â”‚
â”‚  this.tasks$ = apiService.getTasks()    â”‚
â”‚  // Observable en template con async    â”‚
â”‚  // <ion-list *ngFor="let t of tasks$"> â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª MATRIZ DE TESTING

```
JEST (Unit Tests)
â”œâ”€â”€ Auth Service
â”‚   â”œâ”€ register() - crea usuario
â”‚   â”œâ”€ login() - inicia sesiÃ³n
â”‚   â”œâ”€ logout() - cierra sesiÃ³n
â”‚   â”œâ”€ getIdToken() - obtiene token
â”‚   â””â”€ isAuthenticated() - valida sesiÃ³n
â”‚
â”œâ”€â”€ Encryption Service
â”‚   â”œâ”€ encryptString() - AES-256-GCM
â”‚   â”œâ”€ decryptString() - inverso
â”‚   â”œâ”€ encryptObject<T>() - JSON â†’ encrypt
â”‚   â””â”€ clearKey() - limpia clave
â”‚
â”œâ”€â”€ API Service
â”‚   â”œâ”€ getTasks() - GET /tasks
â”‚   â”œâ”€ createTask() - POST /tasks
â”‚   â”œâ”€ updateTask() - PUT /tasks/:id
â”‚   â”œâ”€ deleteTask() - DELETE /tasks/:id
â”‚   â””â”€ processSyncQueue() - offline sync
â”‚
â”œâ”€â”€ Security Utils
â”‚   â”œâ”€ pbkdf2Hash() - PBKDF2 100k
â”‚   â”œâ”€ verifyPassword() - verificaciÃ³n
â”‚   â”œâ”€ validateEmail() - email format
â”‚   â”œâ”€ validatePassword() - min 8 chars
â”‚   â””â”€ generateUUID() - unique IDs
â”‚
â”œâ”€â”€ Page Components
â”‚   â”œâ”€ LoginPage - form + auth
â”‚   â”œâ”€ TasksPage - list + CRUD
â”‚   â””â”€ TaskDetailPage - detail + edit
â”‚
â””â”€ Coverage Target: >70%

APPIUM (E2E Tests)
â”œâ”€â”€ Login Flow
â”‚   â”œâ”€ Input email
â”‚   â”œâ”€ Input password
â”‚   â”œâ”€ Tap login button
â”‚   â””â”€ Verify navigation to /tasks
â”‚
â”œâ”€â”€ Task Management
â”‚   â”œâ”€ Display list
â”‚   â”œâ”€ Create task
â”‚   â”œâ”€ Edit task
â”‚   â”œâ”€ Mark as done
â”‚   â””â”€ Delete task
â”‚
â”œâ”€â”€ Media Integration
â”‚   â”œâ”€ Capture photo
â”‚   â”œâ”€ Select from gallery
â”‚   â””â”€ Attach to task
â”‚
â”œâ”€â”€ Geolocation
â”‚   â”œâ”€ Request permission
â”‚   â”œâ”€ Get current location
â”‚   â””â”€ Attach to task
â”‚
â””â”€ Platforms:
   â”œâ”€ Android (UiAutomator2)
   â””â”€ iOS (XCUITest)
```

---

## ğŸ“Š ESTADÃSTICAS DEL PROYECTO

```
MÃ©tricas de CÃ³digo
â”œâ”€ Archivos nuevos: 25+
â”œâ”€ LÃ­neas de cÃ³digo: ~3,500
â”œâ”€ Archivos de test: 7+
â”œâ”€ LÃ­neas de test: ~1,800
â”œâ”€ DocumentaciÃ³n: 15 archivos
â”œâ”€ LÃ­neas documentaciÃ³n: ~4,000
â””â”€ Type coverage: 100% âœ…

Componentes Implementados
â”œâ”€ Servicios: 6
â”œâ”€ Guards: 1
â”œâ”€ Interceptors: 1
â”œâ”€ Utilities: 3
â”œâ”€ Models/Interfaces: 8
â”œâ”€ Test suites: 19+
â”œâ”€ E2E tests: 8
â””â”€ Config files: 7

Dependencias Principales
â”œâ”€ @angular/core: 20.0.0
â”œâ”€ @ionic/angular: 8.0.0
â”œâ”€ @capacitor/core: 8.0.0
â”œâ”€ firebase: 12.6.0
â”œâ”€ typescript: 5.9.0
â”œâ”€ jest: 30.2.0
â””â”€ appium: 2.0.0+
```

---

## ğŸ¯ ROADMAP DE PRÃ“XIMOS PASOS

```
SEMANA 1-2: ConfiguraciÃ³n & Setup
â”œâ”€ âœ… RefactorizaciÃ³n arquitectura (COMPLETADO)
â”œâ”€ â³ Configurar Firebase credenciales
â”œâ”€ â³ Implementar backend API endpoints
â””â”€ â³ Conectar a base de datos

SEMANA 3: UI Implementation
â”œâ”€ â³ Login page (email/password form)
â”œâ”€ â³ Tasks list page (CRUD interface)
â”œâ”€ â³ Task detail page (photo/location)
â””â”€ â³ Styling & responsive design

SEMANA 4: Testing & QA
â”œâ”€ â³ Run Jest unit tests (>70% coverage)
â”œâ”€ â³ Run Appium E2E tests
â”œâ”€ â³ Manual QA on real devices
â””â”€ â³ Security audit

SEMANA 5: Deployment
â”œâ”€ â³ Build for production (AOT)
â”œâ”€ â³ Android APK/AAB generation
â”œâ”€ â³ iOS IPA generation
â””â”€ â³ Store submission (Play Store, App Store)
```

---

## ğŸš€ QUICK START COMMANDS

```bash
# InstalaciÃ³n
npm install

# Desarrollo
ng serve                    # http://localhost:4200

# Testing
npm run test:jest          # Run all Jest tests
npm run test:jest:watch    # Watch mode
npm run e2e                # E2E tests (requires emulator)

# Build
npm run build:prod         # Production build

# Linting
npm run lint:fix           # Auto-fix code style

# Deployment
npx cap sync               # Sync to native code
cd android && ./gradlew assembleRelease    # Android
cd ios && xcodebuild ...   # iOS
```

---

**Estado**: ğŸŸ¢ **REFACTORING COMPLETADO**  
**PrÃ³ximo Paso**: Configurar Firebase + API Backend  
**DocumentaciÃ³n Completa**: Ver archivos .md en carpeta raÃ­z
